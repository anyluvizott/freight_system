<hr/>
<% if user_signed_in? %>
  <% if current_user.admin? %>
    <div>
      <%= link_to 'Editar Ordem de Serviço', edit_order_of_service_path(@order_of_service)%>
    </div>
  <% end %>
<% end %>
<h2>Ordem de Serviço - Código <%= @order_of_service.order_service_code %></h2>
<dl>
  <dt>Endereço Completo da Saída da Carga:</dt>
  <dd><%= @order_of_service.full_sender_address %></dd>
  <br>
  <dt>Código do Produto:</dt>
  <dd><%= @order_of_service.product_code %></dd>
  <br>
  <dt>Dimensões da Carga:</dt>
  <dd><%= @order_of_service.product_length %>cm x <%= @order_of_service.product_width %>cm x <%= @order_of_service.product_height %>cm </dd>
  <br>
  <dt>Peso da Carga:</dt>
  <dd><%= @order_of_service.product_weight %>kg</dd>
  <br>
  <dt>Endereço Completo do Destinatário:</dt>
  <dd><%= @order_of_service.recipient_full_address %></dd>
  <br>
  <dt>Nome do Destinatário:</dt>
  <dd><%= @order_of_service.recipients_name %></dd>
  <br>
  <dt>Distância que a carga vai percorrer:</dt>
  <dd><%= @order_of_service.distance %>km</dd>
  <br>
</dl>
<div>
  <%= link_to('Voltar', order_of_services_path) %>
</div>
<div>
  <h3> Valor da Entrega </h3>
  <table>
    <tr>
      <td>Modalidade de Entrega: </td>
      <td>Entrega Comum: </td>
      <td>Entrega Expressa: </td>
      <td>Entrega Super Expressa: </td>
    </tr>
    <tr>
      <td>Prazo de Entrega:</td>
      <td><%= @deadline %> horas</td>
      <td><%= (@deadline * 0.75).to_i %> horas</td>
      <td><%= (@deadline * 0.50).to_i %> horas</td>
    </tr>
    <% @select_transport_model.each do |tp| %>
      <tr>
        <td><%= tp.transport_model.name %> </td>
        <td><%= number_to_currency(tp.transport_model.tax + @sum) %> </td>
        <td><%= number_to_currency((tp.transport_model.tax + @sum)*1.25) %> </td>
        <td><%= number_to_currency((tp.transport_model.tax + @sum)*1.50) %> </td>
      </tr>
    <% end %>
  </table>
</div>
<% if @order_of_service.delivered? %>
  <h3> Ordem de Serviço Concluída! - Data: <%= (@order_of_service.delivery_date) %> </h3>
  <br>
<% else %>
  <% if @order_of_service.on_route? %>
    <h3> Ordem de Serviço já está em rota de entrega!</h3>
    <br>
    <%= button_to 'Marcar como Entregue', delivered_order_of_service_path(@order_of_service.id) %>
  <% else %>
    <section id="start_service_orders">
      <h3>Realizar Entrega</h3>
      <% if !@carriers.empty? %>
        <%= form_with(model: [@order_of_service, @start_service_order]) do |f| %>
          <div>
            <%= f.label(:carrier_id, 'Veículos para Entrega' ) %>
            <%= f.collection_select(:carrier_id, @carriers, :id, :description_carrier) %>
            <br>
            <%= f.label :delivery_type_commom, 'Entrega Comum' %>
            <%= f.radio_button :delivery_type, :commom %>
            <br>
            <%= f.label :delivery_type_express, 'Entrega Expressa' %>
            <%= f.radio_button :delivery_type, :express %>
            <br>
            <%= f.label :delivery_type_super_express, 'Entrega Super Expressa' %>
            <%= f.radio_button :delivery_type, :super_express %>
            <br>
          </div>
          <div>
            <%= f.submit 'Confirmar Entrega'%>
          </div>
        <% end %>
      <% else %>
        <p> Não há veículos para essa Ordem de Serviço </p>
      <% end %>
    </section>
  <% end %>
<% end %>
